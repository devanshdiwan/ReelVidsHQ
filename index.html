<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ReelVidsHQ Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        brand: {
                            bg: '#0a0a0a',
                            card: '#171717',
                            border: '#262626',
                            primary: '#10b981', // Emerald 500
                            primaryHover: '#059669', // Emerald 600
                            text: '#e5e5e5',
                            muted: '#a3a3a3'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #0a0a0a;
            color: #e5e5e5;
        }
        .glass-card {
            background: rgba(23, 23, 23, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0a0a0a; 
        }
        ::-webkit-scrollbar-thumb {
            background: #262626; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #404040; 
        }

        /* Editor Styles */
        #editor {
            min-height: 400px;
            outline: none;
            overflow-y: auto;
        }
        #editor:empty:before {
            content: attr(placeholder);
            color: #525252;
        }
        #editor blockquote {
            border-left: 4px solid #10b981;
            padding-left: 1rem;
            color: #a3a3a3;
            font-style: italic;
        }
        #editor ul { list-style-type: disc; margin-left: 1.5rem; }
        #editor ol { list-style-type: decimal; margin-left: 1.5rem; }
        #editor a { color: #10b981; text-decoration: underline; }
        
        .toolbar-btn {
            padding: 0.375rem;
            border-radius: 0.25rem;
            color: #a3a3a3;
            transition: all 0.2s;
        }
        .toolbar-btn:hover {
            background-color: rgba(255,255,255,0.1);
            color: white;
        }
        .toolbar-select {
            background-color: #171717;
            color: #e5e5e5;
            border: 1px solid #262626;
            border-radius: 0.25rem;
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
            outline: none;
        }
        .popover {
            position: absolute;
            background: #171717;
            border: 1px solid #262626;
            border-radius: 0.5rem;
            padding: 0.5rem;
            z-index: 50;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
        }
    </style>
</head>
<body class="min-h-screen font-sans selection:bg-brand-primary selection:text-white">

    <!-- LOGIN SCREEN -->
    <div id="loginScreen" class="fixed inset-0 z-50 flex items-center justify-center bg-black/90 backdrop-blur-sm transition-opacity duration-300">
        <div class="glass-card p-8 rounded-2xl w-full max-w-md shadow-2xl">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold tracking-tight text-white mb-2">ReelVidsHQ <span class="text-brand-primary">Admin</span></h1>
                <p class="text-brand-muted text-sm">Enter PIN to access dashboard</p>
            </div>
            <div class="space-y-4">
                <input type="password" id="pinInput" placeholder="Enter PIN" 
                    class="w-full bg-neutral-900 border border-neutral-800 rounded-lg px-4 py-3 text-white placeholder-neutral-500 focus:outline-none focus:ring-2 focus:ring-brand-primary focus:border-transparent transition-all">
                <button id="loginBtn" 
                    class="w-full bg-brand-primary hover:bg-brand-primaryHover text-white font-semibold py-3 rounded-lg transition-colors shadow-lg shadow-brand-primary/20">
                    Enter Dashboard
                </button>
                <div id="loginError" class="text-red-500 text-sm text-center hidden font-medium bg-red-500/10 py-2 rounded">
                    Incorrect PIN. Try again.
                </div>
            </div>
        </div>
    </div>

    <!-- DASHBOARD CONTENT -->
    <div id="dashboard" class="hidden min-h-screen flex flex-col">
        
        <!-- Navbar -->
        <nav class="sticky top-0 z-40 border-b border-brand-border bg-brand-bg/80 backdrop-blur-md">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center gap-3">
                        <img src="logo.png" onerror="this.src='https://placehold.co/40x40?text=RV'" alt="ReelVidsHQ logo" class="h-8 w-8 object-contain rounded-md bg-white/10 p-0.5">
                        <span class="text-xl font-bold text-white tracking-tight">ReelVidsHQ <span class="text-brand-primary text-sm font-normal ml-1">Admin Panel</span></span>
                    </div>
                    <div class="flex items-center gap-4">
                        <a href="user.html" target="_blank" class="text-sm font-medium text-brand-muted hover:text-white transition-colors flex items-center gap-2">
                            <span>Open Public Site</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>
                        </a>
                        <button id="logoutBtn" class="bg-neutral-800 hover:bg-red-900/50 hover:text-red-200 text-white text-xs font-semibold py-2 px-4 rounded-full border border-neutral-700 transition-colors">
                            Logout
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <main class="flex-1 max-w-7xl mx-auto w-full px-4 sm:px-6 lg:px-8 py-8 space-y-8">

            <!-- STATIC PAGES SELECTOR -->
            <section class="glass-card rounded-2xl p-6 shadow-xl border border-brand-border">
                <h3 class="text-sm font-bold text-brand-muted uppercase tracking-wider mb-4">Edit Static Pages</h3>
                <div class="flex flex-wrap gap-4">
                    <button onclick="window.editPage('about')" class="bg-neutral-800 hover:bg-neutral-700 text-white px-4 py-2 rounded-lg text-sm font-medium border border-neutral-700 transition-colors">Edit About Us</button>
                    <button onclick="window.editPage('contact')" class="bg-neutral-800 hover:bg-neutral-700 text-white px-4 py-2 rounded-lg text-sm font-medium border border-neutral-700 transition-colors">Edit Contact</button>
                    <button onclick="window.editPage('privacy')" class="bg-neutral-800 hover:bg-neutral-700 text-white px-4 py-2 rounded-lg text-sm font-medium border border-neutral-700 transition-colors">Edit Privacy Policy</button>
                    <div class="w-px h-8 bg-neutral-800 mx-2 hidden md:block"></div>
                    <button onclick="window.resetToPostMode()" class="bg-brand-primary/10 hover:bg-brand-primary/20 text-brand-primary px-4 py-2 rounded-lg text-sm font-medium border border-brand-primary/30 transition-colors">Create New Post</button>
                </div>
            </section>

            <!-- CREATE / EDIT CARD -->
            <section class="glass-card rounded-2xl overflow-hidden shadow-xl">
                <div class="px-6 py-4 border-b border-brand-border bg-white/5 flex justify-between items-center">
                    <h2 id="formTitle" class="text-lg font-semibold text-white flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-brand-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" /></svg>
                        Create New Post
                    </h2>
                    <button id="cancelEditBtn" class="hidden text-xs text-brand-muted hover:text-white underline decoration-dashed">Cancel Edit</button>
                </div>
                
                <div class="p-6">
                    <form id="postForm" class="space-y-6">
                        <input type="hidden" id="postId">

                        <!-- POST SPECIFIC FIELDS WRAPPER -->
                        <div id="postSpecificFields">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                <!-- Title (Shared but moved inside grid for posts) -->
                                <div class="space-y-2">
                                    <label class="block text-sm font-medium text-brand-muted">Title</label>
                                    <input type="text" id="title" class="post-input w-full bg-neutral-900 border border-brand-border rounded-lg px-4 py-2.5 text-white focus:ring-2 focus:ring-brand-primary focus:border-transparent">
                                </div>

                                <!-- Thumbnail -->
                                <div class="space-y-2">
                                    <label class="block text-sm font-medium text-brand-muted">Thumbnail URL</label>
                                    <input type="url" id="thumbnailUrl" class="post-input w-full bg-neutral-900 border border-brand-border rounded-lg px-4 py-2.5 text-white focus:ring-2 focus:ring-brand-primary focus:border-transparent">
                                    <p class="text-xs text-brand-muted flex items-center gap-1">
                                        Upload image on <a href="https://freeimage.host" target="_blank" class="text-brand-primary hover:underline">freeimage.host</a>
                                    </p>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                                <!-- Category -->
                                <div class="space-y-2">
                                    <label class="block text-sm font-medium text-brand-muted">Category</label>
                                    <select id="category" class="post-input w-full bg-neutral-900 border border-brand-border rounded-lg px-4 py-2.5 text-white focus:ring-2 focus:ring-brand-primary">
                                        <option value="Bollywood">Bollywood</option>
                                        <option value="Hollywood">Hollywood</option>
                                        <option value="South">South</option>
                                        <option value="Web Series">Web Series</option>
                                        <option value="Anime">Anime</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>

                                <!-- Year -->
                                <div class="space-y-2">
                                    <label class="block text-sm font-medium text-brand-muted">Release Year</label>
                                    <input type="number" id="releaseYear" placeholder="2024" class="post-input w-full bg-neutral-900 border border-brand-border rounded-lg px-4 py-2.5 text-white focus:ring-2 focus:ring-brand-primary">
                                </div>

                                <!-- Rating -->
                                <div class="space-y-2">
                                    <label class="block text-sm font-medium text-brand-muted">Rating (1-10)</label>
                                    <input type="number" step="0.1" min="1" max="10" id="rating" placeholder="8.5" class="post-input w-full bg-neutral-900 border border-brand-border rounded-lg px-4 py-2.5 text-white focus:ring-2 focus:ring-brand-primary">
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                <!-- Language -->
                                <div class="space-y-2">
                                    <label class="block text-sm font-medium text-brand-muted">Language</label>
                                    <input type="text" id="language" placeholder="Hindi, English" class="post-input w-full bg-neutral-900 border border-brand-border rounded-lg px-4 py-2.5 text-white focus:ring-2 focus:ring-brand-primary">
                                </div>

                                <!-- Tags -->
                                <div class="space-y-2">
                                    <label class="block text-sm font-medium text-brand-muted">Tags (comma separated)</label>
                                    <input type="text" id="tags" placeholder="Action, Drama, Thriller" class="post-input w-full bg-neutral-900 border border-brand-border rounded-lg px-4 py-2.5 text-white focus:ring-2 focus:ring-brand-primary">
                                </div>
                            </div>

                            <!-- Short Description -->
                            <div class="space-y-2 mb-6">
                                <label class="block text-sm font-medium text-brand-muted">Short Description</label>
                                <textarea id="shortDescription" rows="2" maxlength="200" class="post-input w-full bg-neutral-900 border border-brand-border rounded-lg px-4 py-2.5 text-white focus:ring-2 focus:ring-brand-primary placeholder-neutral-600"></textarea>
                            </div>
                        </div>

                        <!-- PAGE ONLY TITLE (Hidden by default) -->
                        <div id="pageTitleField" class="hidden space-y-2">
                            <label class="block text-sm font-medium text-brand-muted">Page Title</label>
                            <input type="text" id="pageTitle" class="w-full bg-neutral-900 border border-brand-border rounded-lg px-4 py-2.5 text-white focus:ring-2 focus:ring-brand-primary focus:border-transparent">
                        </div>

                        <!-- EDITOR SECTION -->
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-brand-muted">Full Content / Body</label>
                            
                            <!-- TOOLBAR -->
                            <div id="toolbar" class="bg-neutral-900 border border-brand-border border-b-0 rounded-t-lg p-2 flex flex-wrap gap-1 items-center">
                                <!-- Undo/Redo -->
                                <button type="button" onclick="cmd('undo')" class="toolbar-btn" title="Undo"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"/></svg></button>
                                <button type="button" onclick="cmd('redo')" class="toolbar-btn mr-2" title="Redo"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 10h-10a8 8 0 00-8 8v2M21 10l-6 6m6-6l-6-6"/></svg></button>
                                
                                <!-- Typography -->
                                <select onchange="cmd('fontName', this.value); this.selectedIndex=0;" class="toolbar-select w-24">
                                    <option value="" disabled selected>Font</option>
                                    <option value="Arial">Arial</option>
                                    <option value="Georgia">Georgia</option>
                                    <option value="Verdana">Verdana</option>
                                    <option value="Courier New">Courier</option>
                                    <option value="Impact">Impact</option>
                                </select>
                                <select onchange="cmd('fontSize', this.value); this.selectedIndex=0;" class="toolbar-select w-20">
                                    <option value="" disabled selected>Size</option>
                                    <option value="1">Small</option>
                                    <option value="3">Normal</option>
                                    <option value="5">Large</option>
                                    <option value="7">Huge</option>
                                </select>
                                <select onchange="cmd('formatBlock', this.value); this.selectedIndex=0;" class="toolbar-select w-24 mr-2">
                                    <option value="" disabled selected>Format</option>
                                    <option value="p">Paragraph</option>
                                    <option value="h2">Heading 2</option>
                                    <option value="h3">Heading 3</option>
                                    <option value="h4">Heading 4</option>
                                </select>

                                <!-- Styling -->
                                <button type="button" onclick="cmd('bold')" class="toolbar-btn font-bold" title="Bold">B</button>
                                <button type="button" onclick="cmd('italic')" class="toolbar-btn italic" title="Italic">I</button>
                                <button type="button" onclick="cmd('underline')" class="toolbar-btn underline mr-2" title="Underline">U</button>
                                
                                <!-- Colors -->
                                <div class="relative inline-block">
                                    <button type="button" class="toolbar-btn text-brand-primary" title="Text Color" onclick="document.getElementById('foreColorPicker').click()">A</button>
                                    <input type="color" id="foreColorPicker" class="absolute opacity-0 w-0 h-0" onchange="cmd('foreColor', this.value)">
                                </div>
                                <div class="relative inline-block mr-2">
                                    <button type="button" class="toolbar-btn bg-yellow-500/20 text-yellow-500" title="Highlight" onclick="document.getElementById('hiliteColorPicker').click()">H</button>
                                    <input type="color" id="hiliteColorPicker" class="absolute opacity-0 w-0 h-0" onchange="cmd('hiliteColor', this.value)">
                                </div>

                                <!-- Alignment -->
                                <button type="button" onclick="cmd('justifyLeft')" class="toolbar-btn"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h10M4 18h16"/></svg></button>
                                <button type="button" onclick="cmd('justifyCenter')" class="toolbar-btn"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M7 12h10M4 18h16"/></svg></button>
                                <button type="button" onclick="cmd('justifyRight')" class="toolbar-btn"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M14 12h10M4 18h16"/></svg></button>
                                <button type="button" onclick="cmd('justifyFull')" class="toolbar-btn mr-2"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg></button>

                                <!-- Lists -->
                                <button type="button" onclick="cmd('insertOrderedList')" class="toolbar-btn"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h12M7 12h12M7 17h12M3 7h.01M3 12h.01M3 17h.01"/></svg></button>
                                <button type="button" onclick="cmd('insertUnorderedList')" class="toolbar-btn mr-2"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg></button>

                                <!-- Inserts -->
                                <button type="button" onclick="insertLink()" class="toolbar-btn" title="Link"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/></svg></button>
                                <button type="button" onclick="insertImage()" class="toolbar-btn" title="Image"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg></button>
                                <button type="button" onclick="insertVideo()" class="toolbar-btn" title="Video"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg></button>
                                <button type="button" onclick="togglePopover('emojiPopover')" class="toolbar-btn relative" title="Emoji">ðŸ˜€</button>
                                <button type="button" onclick="togglePopover('charPopover')" class="toolbar-btn relative font-bold" title="Chars">Î©</button>
                                
                                <button type="button" onclick="cmd('formatBlock', 'blockquote')" class="toolbar-btn ml-2" title="Quote"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"/></svg></button>
                                <button type="button" onclick="cmd('removeFormat')" class="toolbar-btn" title="Clear Format"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg></button>

                                <!-- POPOVERS -->
                                <div id="emojiPopover" class="popover hidden top-10 left-1/2 -translate-x-1/2 w-48 grid grid-cols-5 gap-1"></div>
                                <div id="charPopover" class="popover hidden top-10 right-0 w-48 grid grid-cols-5 gap-1"></div>
                            </div>

                            <!-- EDITING AREA -->
                            <div id="editor" contenteditable="true" class="w-full bg-neutral-900 border border-brand-border border-t-0 rounded-b-lg px-4 py-4 text-white prose prose-invert max-w-none placeholder-neutral-600 focus:ring-2 focus:ring-brand-primary" placeholder="Write your awesome content here..."></div>
                            
                            <!-- RAW HTML (Hidden by default) -->
                            <textarea id="rawHtml" class="hidden w-full bg-black border border-brand-border rounded-lg px-4 py-2.5 text-green-400 font-mono text-xs h-[400px]"></textarea>

                            <div class="flex justify-between items-center text-xs text-brand-muted mt-2">
                                <div class="flex gap-2">
                                    <button type="button" onclick="toggleSource()" class="hover:text-white underline">View HTML Source</button>
                                    <button type="button" onclick="document.getElementById('editor').innerHTML=''" class="text-red-500 hover:text-red-400">Clear</button>
                                </div>
                                <span><span class="text-brand-primary font-bold">TIP:</span> Type <strong>[AD]</strong> to insert ads.</span>
                            </div>
                        </div>

                        <!-- Checkbox (Post Only) -->
                        <div id="featuredField" class="flex items-center gap-3 bg-neutral-900/50 p-3 rounded-lg border border-neutral-800 w-fit">
                            <input type="checkbox" id="featured" class="w-5 h-5 rounded border-neutral-600 text-brand-primary focus:ring-brand-primary bg-neutral-800">
                            <label for="featured" class="text-sm text-white select-none cursor-pointer font-medium">Mark as Featured Post</label>
                        </div>

                        <!-- Buttons -->
                        <div class="pt-2 flex gap-4">
                            <button type="submit" id="submitBtn" class="bg-brand-primary hover:bg-brand-primaryHover text-white px-8 py-3 rounded-lg font-bold shadow-lg shadow-brand-primary/20 transition-all active:scale-95 flex-1 md:flex-none">
                                Create Post
                            </button>
                        </div>
                    </form>
                </div>
            </section>

            <!-- POSTS TABLE -->
            <section class="glass-card rounded-2xl overflow-hidden shadow-xl">
                <div class="px-6 py-4 border-b border-brand-border bg-white/5 flex justify-between items-center">
                    <h2 class="text-lg font-semibold text-white">All Posts</h2>
                    <span id="postCount" class="text-xs bg-neutral-800 text-brand-muted px-2 py-1 rounded-full border border-neutral-700">0 posts</span>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="bg-neutral-900/50 text-xs text-brand-muted uppercase tracking-wider border-b border-brand-border">
                                <th class="p-4 font-medium">Title</th>
                                <th class="p-4 font-medium">Category</th>
                                <th class="p-4 font-medium text-center">Rating</th>
                                <th class="p-4 font-medium text-center">Year</th>
                                <th class="p-4 font-medium text-center">Featured</th>
                                <th class="p-4 font-medium">Created</th>
                                <th class="p-4 font-medium text-right">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="postsTableBody" class="divide-y divide-brand-border text-sm">
                            <tr>
                                <td colspan="7" class="p-8 text-center text-brand-muted">Loading posts...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

        </main>
    </div>

    <!-- FIREBASE & APP LOGIC -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
        import { getDatabase, ref, push, set, get, update, remove, child } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

        // FIREBASE CONFIG
        const firebaseConfig = {
          apiKey: "AIzaSyCQL0cNijjLZnRSOoC3RZLnGmIo3VjlH_A",
          authDomain: "primesnapsxplayer.firebaseapp.com",
          databaseURL: "https://primesnapsxplayer-default-rtdb.firebaseio.com",
          projectId: "primesnapsxplayer",
          storageBucket: "primesnapsxplayer.firebasestorage.app",
          messagingSenderId: "703281925000",
          appId: "1:703281925000:web:f24c146929703da281c83d",
          measurementId: "G-Q65Y1Y0SYE"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        const ADMIN_PIN = "1234";

        // DOM Elements
        const loginScreen = document.getElementById('loginScreen');
        const dashboard = document.getElementById('dashboard');
        const pinInput = document.getElementById('pinInput');
        const loginBtn = document.getElementById('loginBtn');
        const loginError = document.getElementById('loginError');
        const logoutBtn = document.getElementById('logoutBtn');
        const postForm = document.getElementById('postForm');
        const postsTableBody = document.getElementById('postsTableBody');
        const submitBtn = document.getElementById('submitBtn');
        const formTitle = document.getElementById('formTitle');
        const cancelEditBtn = document.getElementById('cancelEditBtn');
        const postCountLabel = document.getElementById('postCount');
        
        // Sections
        const postSpecificFields = document.getElementById('postSpecificFields');
        const pageTitleField = document.getElementById('pageTitleField');
        const featuredField = document.getElementById('featuredField');

        // Editor Elements
        const editor = document.getElementById('editor');
        const rawHtml = document.getElementById('rawHtml');

        let isEditMode = false;
        let isPageMode = false;
        let editingPageId = null;
        let allPosts = [];

        // --- EDITOR LOGIC ---
        
        // Populate Popovers
        const emojis = ['ðŸ˜€','ðŸ˜‚','ðŸ¥°','ðŸ˜','ðŸ˜Ž','ðŸ˜­','ðŸ˜¡','ðŸ‘','ðŸ‘Ž','ðŸ™','ðŸ”¥','âœ¨','â¤ï¸','âœ…','â­','ðŸ’¡','ðŸŽ‰','ðŸ‘‹','ðŸ¤”','ðŸ‘€'];
        const specialChars = ['Â©','Â®','â„¢','â€¢','â†’','â‡’','âœ“','â˜…','Â½','Â¼','Â±','â‰ ','â‰¤','â‰¥','Ã·','Ã—','âˆž','â‰ˆ','Î©','â‚¬'];
        
        window.cmd = (command, value) => {
            document.execCommand(command, false, value);
            editor.focus();
        };

        window.togglePopover = (id) => {
            const el = document.getElementById(id);
            // close others
            document.querySelectorAll('.popover').forEach(p => {
                if(p.id !== id) p.classList.add('hidden');
            });
            el.classList.toggle('hidden');
        };

        window.insertHTML = (html) => {
            document.execCommand('insertHTML', false, html);
            document.querySelectorAll('.popover').forEach(p => p.classList.add('hidden'));
            editor.focus();
        };

        // Populate Emojis
        const emojiContainer = document.getElementById('emojiPopover');
        emojis.forEach(char => {
            const btn = document.createElement('button');
            btn.type = 'button';
            btn.className = 'hover:bg-neutral-800 rounded p-1 text-lg';
            btn.textContent = char;
            btn.onclick = () => window.insertHTML(char);
            emojiContainer.appendChild(btn);
        });

        // Populate Chars
        const charContainer = document.getElementById('charPopover');
        specialChars.forEach(char => {
            const btn = document.createElement('button');
            btn.type = 'button';
            btn.className = 'hover:bg-neutral-800 rounded p-1 font-mono text-sm';
            btn.textContent = char;
            btn.onclick = () => window.insertHTML(char);
            charContainer.appendChild(btn);
        });

        window.insertLink = () => {
            const url = prompt("Enter Link URL:", "https://");
            if (url) document.execCommand('createLink', false, url);
        };

        window.insertImage = () => {
            const url = prompt("Enter Image URL:", "https://");
            if (url) document.execCommand('insertImage', false, url);
        };

        window.insertVideo = () => {
            const url = prompt("Enter Video URL (YouTube, Vimeo, etc):", "");
            if (url) {
                let embedCode = url;
                // Basic Youtube converter
                if (url.includes('youtube.com/watch?v=')) {
                    const videoId = url.split('v=')[1].split('&')[0];
                    embedCode = `https://www.youtube.com/embed/${videoId}`;
                } else if (url.includes('youtu.be/')) {
                    const videoId = url.split('youtu.be/')[1];
                    embedCode = `https://www.youtube.com/embed/${videoId}`;
                }
                
                const html = `<div class="aspect-video w-full max-w-2xl mx-auto my-4 rounded-lg overflow-hidden border border-neutral-700 bg-black"><iframe src="${embedCode}" class="w-full h-full" frameborder="0" allowfullscreen></iframe></div><p><br></p>`;
                window.insertHTML(html);
            }
        };

        window.toggleSource = () => {
            if (rawHtml.classList.contains('hidden')) {
                // Switch to Source
                rawHtml.value = editor.innerHTML;
                editor.classList.add('hidden');
                rawHtml.classList.remove('hidden');
            } else {
                // Switch to WYSIWYG
                editor.innerHTML = rawHtml.value;
                rawHtml.classList.add('hidden');
                editor.classList.remove('hidden');
            }
        };

        // Close popovers on click outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('#toolbar')) {
                document.querySelectorAll('.popover').forEach(p => p.classList.add('hidden'));
            }
        });


        // --- AUTH LOGIC ---
        function checkAuth() {
            const isAuth = localStorage.getItem('reelvids_admin_auth');
            if (isAuth === 'true') {
                showDashboard();
            }
        }

        function showDashboard() {
            loginScreen.classList.add('opacity-0', 'pointer-events-none');
            setTimeout(() => {
                loginScreen.classList.add('hidden');
            }, 300);
            dashboard.classList.remove('hidden');
            loadPosts();
        }

        loginBtn.addEventListener('click', () => {
            const pin = pinInput.value;
            if (pin === ADMIN_PIN) {
                localStorage.setItem('reelvids_admin_auth', 'true');
                showDashboard();
            } else {
                loginError.classList.remove('hidden');
                pinInput.value = '';
                pinInput.focus();
            }
        });

        logoutBtn.addEventListener('click', () => {
            localStorage.removeItem('reelvids_admin_auth');
            location.reload();
        });

        // --- MODE SWITCHING ---

        // Exposed to window for onclick
        window.editPage = async (pageId) => {
            isPageMode = true;
            isEditMode = true; // Technically editing a page
            editingPageId = pageId;

            // Update UI
            postSpecificFields.classList.add('hidden');
            featuredField.classList.add('hidden');
            pageTitleField.classList.remove('hidden');
            
            // Disable validation for hidden post inputs
            document.querySelectorAll('.post-input').forEach(el => el.removeAttribute('required'));

            formTitle.innerHTML = `<span class="text-brand-primary">Editing Page:</span> <span class="uppercase">${pageId}</span>`;
            submitBtn.textContent = 'Save Page';
            submitBtn.className = "bg-brand-primary hover:bg-brand-primaryHover text-white px-8 py-3 rounded-lg font-bold shadow-lg shadow-brand-primary/20 transition-all flex-1 md:flex-none";
            cancelEditBtn.classList.remove('hidden');

            // Load Content
            try {
                const snapshot = await get(child(ref(db), `pages/${pageId}`));
                if (snapshot.exists()) {
                    const data = snapshot.val();
                    document.getElementById('pageTitle').value = data.title || '';
                    editor.innerHTML = data.content || '';
                } else {
                    document.getElementById('pageTitle').value = pageId.charAt(0).toUpperCase() + pageId.slice(1);
                    editor.innerHTML = '';
                }
            } catch (e) {
                console.error(e);
                alert("Error loading page content.");
            }
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        window.resetToPostMode = () => {
            clearForm();
        };

        // --- CRUD LOGIC ---

        function slugify(text) {
            return text.toString().toLowerCase()
                .replace(/\s+/g, '-')
                .replace(/[^\w\-]+/g, '')
                .replace(/\-\-+/g, '-')
                .replace(/^-+/, '')
                .replace(/-+$/, '');
        }

        function formatDate(timestamp) {
            if (!timestamp) return '-';
            return new Date(timestamp).toLocaleDateString('en-US', {
                month: 'short', day: 'numeric', year: 'numeric'
            });
        }

        async function loadPosts() {
            const dbRef = ref(db);
            try {
                const snapshot = await get(child(dbRef, `posts`));
                if (snapshot.exists()) {
                    const data = snapshot.val();
                    allPosts = Object.values(data).sort((a, b) => b.createdAt - a.createdAt);
                    renderPostsTable();
                } else {
                    allPosts = [];
                    renderPostsTable();
                }
            } catch (error) {
                console.error("Error fetching posts:", error);
                postsTableBody.innerHTML = `<tr><td colspan="7" class="p-8 text-center text-red-500">Error loading data.</td></tr>`;
            }
        }

        function renderPostsTable() {
            postCountLabel.textContent = `${allPosts.length} posts`;
            
            if (allPosts.length === 0) {
                postsTableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="p-12 text-center flex flex-col items-center justify-center text-brand-muted">
                            <span class="text-4xl mb-2">ðŸ“­</span>
                            <span>No posts yet. Create your first one!</span>
                        </td>
                    </tr>`;
                return;
            }

            let html = '';
            allPosts.forEach(post => {
                html += `
                    <tr class="hover:bg-white/5 transition-colors group">
                        <td class="p-4">
                            <div class="font-medium text-white truncate max-w-[200px]">${post.title}</div>
                        </td>
                        <td class="p-4 text-brand-muted">${post.category}</td>
                        <td class="p-4 text-center">
                            <span class="bg-neutral-800 text-brand-primary px-2 py-1 rounded text-xs font-bold border border-neutral-700">${post.rating}</span>
                        </td>
                        <td class="p-4 text-center text-brand-muted">${post.releaseYear}</td>
                        <td class="p-4 text-center">
                            ${post.featured ? '<span class="text-yellow-500">â˜…</span>' : '<span class="text-neutral-700">Â·</span>'}
                        </td>
                        <td class="p-4 text-brand-muted text-xs">${formatDate(post.createdAt)}</td>
                        <td class="p-4 text-right">
                            <div class="flex items-center justify-end gap-2 opacity-60 group-hover:opacity-100 transition-opacity">
                                <button onclick="window.editPost('${post.id}')" class="p-1.5 hover:bg-blue-500/20 text-blue-400 rounded transition-colors" title="Edit">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                                </button>
                                <button onclick="window.deletePost('${post.id}')" class="p-1.5 hover:bg-red-500/20 text-red-400 rounded transition-colors" title="Delete">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            postsTableBody.innerHTML = html;
        }

        // --- FORM HANDLING ---

        postForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            submitBtn.disabled = true;
            submitBtn.textContent = 'Saving...';

            // Sync Editor Content
            // Check if user is in source mode
            let contentToSave = editor.innerHTML;
            if(!rawHtml.classList.contains('hidden')){
                contentToSave = rawHtml.value;
            }

            // SAVE STATIC PAGE
            if (isPageMode && editingPageId) {
                const pageTitle = document.getElementById('pageTitle').value;
                
                try {
                    await set(ref(db, `pages/${editingPageId}`), {
                        title: pageTitle,
                        content: contentToSave,
                        updatedAt: Date.now()
                    });
                    alert('Page saved successfully!');
                } catch (error) {
                    console.error("Error saving page:", error);
                    alert("Error saving page.");
                } finally {
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Save Page';
                }
                return;
            }

            // SAVE POST (Existing Logic)
            const id = document.getElementById('postId').value;
            const title = document.getElementById('title').value;
            const category = document.getElementById('category').value;
            const releaseYear = Number(document.getElementById('releaseYear').value);
            const rating = Number(document.getElementById('rating').value);
            const language = document.getElementById('language').value;
            const featured = document.getElementById('featured').checked;
            const shortDescription = document.getElementById('shortDescription').value;
            const thumbnailUrl = document.getElementById('thumbnailUrl').value;
            const tagsInput = document.getElementById('tags').value;
            
            const tags = tagsInput.split(',').map(tag => tag.trim()).filter(tag => tag.length > 0);
            const slug = slugify(title);

            const postData = {
                title,
                slug,
                thumbnailUrl,
                shortDescription,
                fullContent: contentToSave,
                category,
                tags,
                releaseYear,
                language,
                rating,
                featured,
                updatedAt: Date.now()
            };

            try {
                if (isEditMode && id) {
                    // Update
                    postData.id = id;
                    // Preserve original creation date
                    const originalPost = allPosts.find(p => p.id === id);
                    postData.createdAt = originalPost ? originalPost.createdAt : Date.now();
                    
                    await update(ref(db, 'posts/' + id), postData);
                    alert('Post updated successfully!');
                } else {
                    // Create
                    const newPostRef = push(ref(db, 'posts'));
                    postData.id = newPostRef.key;
                    postData.createdAt = Date.now();
                    await set(newPostRef, postData);
                    alert('Post created successfully!');
                }
                
                clearForm();
                loadPosts();
            } catch (error) {
                console.error("Error saving:", error);
                alert("Error saving post. Check console.");
            } finally {
                submitBtn.disabled = false;
            }
        });

        window.editPost = (id) => {
            // Force Post Mode
            resetToPostMode();

            const post = allPosts.find(p => p.id === id);
            if (!post) return;

            document.getElementById('postId').value = post.id;
            document.getElementById('title').value = post.title;
            document.getElementById('thumbnailUrl').value = post.thumbnailUrl;
            document.getElementById('category').value = post.category;
            document.getElementById('releaseYear').value = post.releaseYear;
            document.getElementById('rating').value = post.rating;
            document.getElementById('language').value = post.language;
            document.getElementById('shortDescription').value = post.shortDescription;
            editor.innerHTML = post.fullContent || '';
            document.getElementById('tags').value = post.tags ? post.tags.join(', ') : '';
            document.getElementById('featured').checked = post.featured;

            isEditMode = true;
            formTitle.innerHTML = `<span class="text-blue-400">Editing:</span> ${post.title.substring(0, 20)}...`;
            submitBtn.textContent = 'Update Post';
            submitBtn.classList.remove('bg-brand-primary', 'hover:bg-brand-primaryHover');
            submitBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
            cancelEditBtn.classList.remove('hidden');

            window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        window.deletePost = async (id) => {
            if (confirm('Are you sure you want to delete this post? This cannot be undone.')) {
                try {
                    await remove(ref(db, 'posts/' + id));
                    loadPosts(); // Refresh
                } catch (error) {
                    console.error("Error deleting:", error);
                    alert("Error deleting post.");
                }
            }
        };

        function clearForm() {
            postForm.reset();
            isEditMode = false;
            isPageMode = false;
            editingPageId = null;

            editor.innerHTML = '';
            rawHtml.value = '';
            rawHtml.classList.add('hidden');
            editor.classList.remove('hidden');

            // UI Reset
            postSpecificFields.classList.remove('hidden');
            featuredField.classList.remove('hidden');
            pageTitleField.classList.add('hidden');
            
            // Enable validation for post inputs
            document.querySelectorAll('.post-input').forEach(el => el.setAttribute('required', 'true'));

            document.getElementById('postId').value = '';
            formTitle.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-brand-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" /></svg> Create New Post`;
            submitBtn.textContent = 'Create Post';
            submitBtn.className = "bg-brand-primary hover:bg-brand-primaryHover text-white px-8 py-3 rounded-lg font-bold shadow-lg shadow-brand-primary/20 transition-all active:scale-95 flex-1 md:flex-none";
            cancelEditBtn.classList.add('hidden');
        }

        cancelEditBtn.addEventListener('click', (e) => {
            e.preventDefault();
            clearForm();
        });

        // Initialize
        checkAuth();

    </script>
</body>
</html>
